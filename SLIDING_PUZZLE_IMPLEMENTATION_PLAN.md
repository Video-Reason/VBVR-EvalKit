# Sliding Puzzle Task å®ç°è®¡åˆ’

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

**Sliding Puzzleï¼ˆæ»‘åŠ¨æ‹¼å›¾ï¼‰**æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç›Šæ™ºæ¸¸æˆä»»åŠ¡ï¼Œæµ‹è¯•è§†é¢‘ç”Ÿæˆæ¨¡å‹çš„ï¼š
- **ç©ºé—´æ¨ç†èƒ½åŠ›**ï¼šç†è§£æ‹¼å›¾å—çš„ç›¸å¯¹ä½ç½®å…³ç³»
- **ç®€å•ç§»åŠ¨ç†è§£**ï¼šç†è§£æ»‘åŠ¨ç§»åŠ¨è§„åˆ™ï¼ˆ1-2æ­¥ï¼‰
- **è§†è§‰ä¸€è‡´æ€§**ï¼šåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ä¿æŒæ‹¼å›¾å—çš„è§†è§‰ç‰¹å¾
- **ç›®æ ‡è¯†åˆ«**ï¼šè¯†åˆ«æ¥è¿‘å®Œæˆçš„çŠ¶æ€å¹¶æ‰§è¡Œæœ€åæ­¥éª¤

### ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ
**å…³é”®ç®€åŒ–**ï¼šåªç”Ÿæˆ**æ¥è¿‘å®Œæˆ**çš„æ‹¼å›¾ï¼Œåªéœ€**1-2æ­¥ç§»åŠ¨**å³å¯å®Œæˆã€‚
- âœ… é¿å…å¤æ‚çš„å¤šæ­¥è§„åˆ’ï¼ˆè¶…å‡ºè§†é¢‘æ¨¡å‹èƒ½åŠ›ï¼‰
- âœ… æµ‹è¯•åŸºæœ¬çš„ç©ºé—´æ¨ç†å’Œç§»åŠ¨ç†è§£
- âœ… æ›´å®¹æ˜“éªŒè¯æ¨¡å‹æ˜¯å¦æ­£ç¡®
- âœ… ç¬¦åˆè§†é¢‘ç”Ÿæˆæ¨¡å‹çš„è®¤çŸ¥èƒ½åŠ›èŒƒå›´

## ğŸ¯ æµ‹è¯•ç›®æ ‡

### æ ¸å¿ƒè®¤çŸ¥èƒ½åŠ›ï¼ˆç®€åŒ–ç‰ˆ - 1-2æ­¥ç§»åŠ¨ï¼‰
1. **ç©ºé—´æ¨ç†ï¼ˆSpatial Reasoningï¼‰**
   - ç†è§£2Dç½‘æ ¼ç©ºé—´
   - è¯†åˆ«æ‹¼å›¾å—çš„å½“å‰ä½ç½®å’Œç›®æ ‡ä½ç½®
   - ç†è§£ç§»åŠ¨è§„åˆ™ï¼ˆåªèƒ½ç§»åŠ¨åˆ°ç©ºç™½ä½ç½®ï¼‰

2. **ç®€å•è§„åˆ’ï¼ˆSimple Planningï¼‰**
   - è¯†åˆ«éœ€è¦ç§»åŠ¨çš„æ‹¼å›¾å—ï¼ˆ1-2ä¸ªï¼‰
   - ç†è§£ç§»åŠ¨æ–¹å‘ï¼ˆä¸Š/ä¸‹/å·¦/å³ï¼‰
   - æ‰§è¡Œ1-2æ­¥ç®€å•ç§»åŠ¨

3. **è§†è§‰ä¸€è‡´æ€§ï¼ˆVisual Consistencyï¼‰**
   - ä¿æŒæ‹¼å›¾å—çš„è§†è§‰ç‰¹å¾ï¼ˆæ•°å­—ã€é¢œè‰²ï¼‰
   - æ­£ç¡®æ˜¾ç¤ºæ»‘åŠ¨åŠ¨ç”»
   - ç†è§£ç©ºç™½ä½ç½®çš„ç§»åŠ¨

4. **ç›®æ ‡è¯†åˆ«ï¼ˆGoal Recognitionï¼‰**
   - è¯†åˆ«æ¥è¿‘å®Œæˆçš„çŠ¶æ€
   - ç†è§£å®Œæˆæ¡ä»¶ï¼ˆæ•°å­—æŒ‰é¡ºåºæ’åˆ—ï¼‰
   - æ‰§è¡Œæœ€åçš„ç§»åŠ¨æ­¥éª¤

### ä¸ºä»€ä¹ˆé€‰æ‹©1-2æ­¥è®¾è®¡ï¼Ÿ
- âœ… **ç¬¦åˆè§†é¢‘æ¨¡å‹èƒ½åŠ›**ï¼šä¸éœ€è¦å¤æ‚çš„å¤šæ­¥è§„åˆ’
- âœ… **æµ‹è¯•æ ¸å¿ƒèƒ½åŠ›**ï¼šç©ºé—´æ¨ç†ã€ç§»åŠ¨ç†è§£ã€è§†è§‰ä¸€è‡´æ€§
- âœ… **æ˜“äºéªŒè¯**ï¼šå¯ä»¥æ¸…æ¥šåˆ¤æ–­æ¨¡å‹æ˜¯å¦æ­£ç¡®
- âœ… **é¿å…è¿‡åº¦å¤æ‚**ï¼šä¸ä¼šå› ä¸ºè§„åˆ’éš¾åº¦æ©ç›–å…¶ä»–èƒ½åŠ›

## ğŸ—ï¸ å®ç°æ¶æ„

### 1. æ–‡ä»¶ç»“æ„

```
vmevalkit/tasks/sliding_puzzle_task/
â”œâ”€â”€ __init__.py                    # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ sliding_puzzle_reasoning.py    # æ ¸å¿ƒç”Ÿæˆé€»è¾‘
â”œâ”€â”€ PROMPTS.py                     # æç¤ºè¯æ¨¡æ¿
â””â”€â”€ SLIDING_PUZZLE.md             # ä»»åŠ¡æ–‡æ¡£
```

### 2. æ ¸å¿ƒç»„ä»¶

#### 2.1 SlidingPuzzleGenerator
- **åŠŸèƒ½**ï¼šç”Ÿæˆæ¥è¿‘å®Œæˆçš„æ»‘åŠ¨æ‹¼å›¾ï¼ˆåªéœ€1-2æ­¥å®Œæˆï¼‰
- **å…³é”®æ–¹æ³•**ï¼š
  - `generate_near_complete_puzzle(size, num_moves)`: ä»å®ŒæˆçŠ¶æ€æ‰§è¡ŒNæ­¥åå‘ç§»åŠ¨
  - `get_valid_moves(puzzle, blank_pos)`: è·å–ç©ºç™½ä½ç½®çš„æœ‰æ•ˆç§»åŠ¨æ–¹å‘
  - `apply_move(puzzle, direction)`: æ‰§è¡Œä¸€æ­¥ç§»åŠ¨
  - `render_puzzle(puzzle, size)`: æ¸²æŸ“æ‹¼å›¾å›¾åƒ

#### 2.2 PuzzleSolverï¼ˆç®€åŒ–ç‰ˆ - å¯é€‰ï¼‰
- **åŠŸèƒ½**ï¼šéªŒè¯æ‹¼å›¾çŠ¶æ€å’Œè®¡ç®—è§£é•¿åº¦ï¼ˆç”¨äºéš¾åº¦åˆ†çº§ï¼‰
- **å…³é”®æ–¹æ³•**ï¼š
  - `get_solution_length(puzzle, goal)`: è®¡ç®—ä»å½“å‰çŠ¶æ€åˆ°ç›®æ ‡çŠ¶æ€çš„æ­¥æ•°
  - `is_complete(puzzle, goal)`: æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ
  - **æ³¨æ„**ï¼šç”±äºåªç”Ÿæˆ1-2æ­¥çš„æ‹¼å›¾ï¼Œå¯èƒ½ä¸éœ€è¦å¤æ‚çš„A*æ±‚è§£å™¨

#### 2.3 SlidingPuzzleTaskPair
- **æ•°æ®ç»“æ„**ï¼š
  ```python
  @dataclass
  class SlidingPuzzleTaskPair:
      id: str
      prompt: str
      first_image_path: str      # æ‰“ä¹±çŠ¶æ€çš„æ‹¼å›¾
      final_image_path: str      # å®ŒæˆçŠ¶æ€çš„æ‹¼å›¾
      task_category: str          # "SlidingPuzzle"
      puzzle_data: Dict[str, Any] # æ‹¼å›¾å…ƒæ•°æ®
      difficulty: str             # "easy", "medium", "hard"
      puzzle_size: Tuple[int, int] # (3, 3) æˆ– (4, 4)
      initial_state: List[List[int]] # åˆå§‹çŠ¶æ€çŸ©é˜µ
      goal_state: List[List[int]]    # ç›®æ ‡çŠ¶æ€çŸ©é˜µ
      solution_length: int           # è§£çš„é•¿åº¦ï¼ˆ1-3æ­¥ï¼‰
      num_moves_from_complete: int    # ä»å®ŒæˆçŠ¶æ€åå‘ç§»åŠ¨çš„æ­¥æ•°
      created_at: str
  ```

### 3. æ‹¼å›¾è®¾è®¡

#### 3.1 å°ºå¯¸é€‰æ‹©
- **Easy**: 3Ã—3 (8ä¸ªæ‹¼å›¾å— + 1ä¸ªç©ºç™½)
- **Medium**: 4Ã—4 (15ä¸ªæ‹¼å›¾å— + 1ä¸ªç©ºç™½)
- **Hard**: 5Ã—5 (24ä¸ªæ‹¼å›¾å— + 1ä¸ªç©ºç™½)

#### 3.2 è§†è§‰è®¾è®¡
- **æ‹¼å›¾å—**ï¼šå¸¦æ•°å­—çš„æ–¹å—ï¼ˆ1, 2, 3, ...ï¼‰
- **ç©ºç™½ä½ç½®**ï¼šç™½è‰²æˆ–ç°è‰²æ–¹å—
- **ç½‘æ ¼çº¿**ï¼šæ¸…æ™°çš„è¾¹ç•Œçº¿
- **é¢œè‰²æ–¹æ¡ˆ**ï¼šé«˜å¯¹æ¯”åº¦ï¼Œæ˜“äºåŒºåˆ†

#### 3.3 å¯è§£æ€§ä¿è¯
- ä½¿ç”¨**é€†åºæ•°**ï¼ˆinversion countï¼‰åˆ¤æ–­å¯è§£æ€§
- åªç”Ÿæˆå¯è§£çš„æ‹¼å›¾çŠ¶æ€
- é€šè¿‡éšæœºç§»åŠ¨æ‰“ä¹±ï¼ˆä¿è¯å¯è§£ï¼‰

## ğŸ“ å®ç°æ­¥éª¤

### Phase 1: åŸºç¡€æ¡†æ¶
1. âœ… åˆ›å»º `sliding_puzzle_task/` ç›®å½•
2. âœ… åˆ›å»º `__init__.py` å¯¼å‡ºæ¥å£
3. âœ… åˆ›å»º `PROMPTS.py` å®šä¹‰æç¤ºè¯
4. âœ… åˆ›å»º `SLIDING_PUZZLE.md` æ–‡æ¡£

### Phase 2: æ ¸å¿ƒé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
1. âœ… å®ç° `SlidingPuzzleGenerator` ç±»
   - ä»å®ŒæˆçŠ¶æ€å¼€å§‹
   - æ‰§è¡Œ1-2æ­¥åå‘ç§»åŠ¨ï¼ˆæ‰“ä¹±ï¼‰
   - è®¡ç®—è§£é•¿åº¦ï¼ˆéªŒè¯ï¼‰
   - æ‹¼å›¾æ¸²æŸ“ï¼ˆmatplotlibï¼‰

2. âš ï¸ `PuzzleSolver` ç±»ï¼ˆç®€åŒ–æˆ–å¯é€‰ï¼‰
   - ç”±äºåªç”Ÿæˆ1-2æ­¥çš„æ‹¼å›¾ï¼Œå¯èƒ½åªéœ€è¦ç®€å•çš„BFS
   - æˆ–è€…ç›´æ¥è®¡ç®—ï¼šä»å®ŒæˆçŠ¶æ€åå‘ç§»åŠ¨Næ­¥ï¼Œè§£å°±æ˜¯Næ­¥

3. âœ… å®ç° `SlidingPuzzleTaskPair` æ•°æ®ç±»
   - æ•°æ®ç»“æ„å®šä¹‰
   - åºåˆ—åŒ–/ååºåˆ—åŒ–

### Phase 3: æ•°æ®é›†ç”Ÿæˆ
1. âœ… å®ç° `create_dataset(num_samples)` å‡½æ•°
   - ç”Ÿæˆå¤šä¸ªæ‹¼å›¾ä»»åŠ¡
   - ä¿å­˜å›¾åƒå’Œå…ƒæ•°æ®
   - è¿”å›ä»»åŠ¡å¯¹åˆ—è¡¨

2. âœ… å®ç°éš¾åº¦åˆ†çº§
   - Easy: 3Ã—3, 1æ­¥è§£ï¼ˆä»å®ŒæˆçŠ¶æ€åå‘ç§»åŠ¨1æ­¥ï¼‰
   - Medium: 3Ã—3æˆ–4Ã—4, 2æ­¥è§£ï¼ˆä»å®ŒæˆçŠ¶æ€åå‘ç§»åŠ¨2æ­¥ï¼‰
   - Hard: 4Ã—4, 2-3æ­¥è§£ï¼ˆä»å®ŒæˆçŠ¶æ€åå‘ç§»åŠ¨2-3æ­¥ï¼‰

### Phase 4: æ³¨å†Œå’Œé›†æˆ
1. âœ… åœ¨ `vmevalkit/utils/constant.py` æ³¨å†Œ
   ```python
   'sliding_puzzle': {
       'emoji': 'ğŸ§©',
       'name': 'Sliding Puzzle',
       'description': 'Spatial reasoning and planning through sliding puzzle solving',
       'module': 'vmevalkit.tasks.sliding_puzzle_task',
       'create_function': 'create_dataset',
       'process_dataset': lambda dataset, num_samples: dataset['pairs']
   }
   ```

2. âœ… æµ‹è¯•ç”Ÿæˆå’Œä¿å­˜
3. âœ… éªŒè¯å›¾åƒè´¨é‡å’Œå¯è§£æ€§

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ‹¼å›¾ç”Ÿæˆç®—æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰
```python
def generate_near_complete_puzzle(size: int, num_moves: int) -> Tuple[List[List[int]], int]:
    """
    ä»å®ŒæˆçŠ¶æ€å¼€å§‹ï¼Œæ‰§è¡Œnum_movesæ­¥åå‘ç§»åŠ¨
    è¿”å›ï¼š(æ‰“ä¹±åçš„æ‹¼å›¾, è§£çš„é•¿åº¦)
    """
    # 1. åˆ›å»ºå®ŒæˆçŠ¶æ€
    goal = create_goal_state(size)  # [[1,2,3],[4,5,6],[7,8,0]]
    puzzle = [row[:] for row in goal]  # æ·±æ‹·è´
    
    # 2. æ‰¾åˆ°ç©ºç™½ä½ç½®
    blank_pos = find_blank(puzzle)
    
    # 3. æ‰§è¡Œnum_movesæ­¥éšæœºç§»åŠ¨ï¼ˆåå‘ï¼‰
    moves = []
    for _ in range(num_moves):
        valid_directions = get_valid_moves(puzzle, blank_pos)
        if not valid_directions:
            break
        direction = random.choice(valid_directions)
        puzzle, blank_pos = apply_move(puzzle, blank_pos, direction)
        moves.append(direction)
    
    # 4. è§£çš„é•¿åº¦å°±æ˜¯ç§»åŠ¨çš„æ­¥æ•°ï¼ˆå› ä¸ºæ˜¯åå‘ç§»åŠ¨ï¼‰
    solution_length = len(moves)
    
    return puzzle, solution_length
```

### æ‹¼å›¾ç”Ÿæˆç­–ç•¥ï¼ˆç®€åŒ–ç‰ˆï¼‰
1. **ä»å®ŒæˆçŠ¶æ€å¼€å§‹**ï¼šä»ç›®æ ‡çŠ¶æ€ï¼ˆ1,2,3,...,n,0ï¼‰å¼€å§‹
2. **è½»å¾®æ‰“ä¹±**ï¼šåªæ‰§è¡Œ1-2æ­¥éšæœºç§»åŠ¨ï¼ˆæ ¹æ®éš¾åº¦ï¼‰
   - Easy: 1æ­¥ç§»åŠ¨
   - Medium: 2æ­¥ç§»åŠ¨
   - Hard: 2-3æ­¥ç§»åŠ¨
3. **ä¿è¯å¯è§£**ï¼šç”±äºæ˜¯ä»å®ŒæˆçŠ¶æ€åå‘ç§»åŠ¨ï¼Œä¿è¯å¯è§£
4. **æ¸²æŸ“å›¾åƒ**ï¼š
   - `first_frame.png`: è½»å¾®æ‰“ä¹±çš„çŠ¶æ€ï¼ˆæ¥è¿‘å®Œæˆï¼‰
   - `final_frame.png`: å®ŒæˆçŠ¶æ€ï¼ˆæ‰€æœ‰æ•°å­—æŒ‰é¡ºåºæ’åˆ—ï¼‰

### æç¤ºè¯è®¾è®¡ï¼ˆé’ˆå¯¹1-2æ­¥ç§»åŠ¨ï¼‰
```python
PROMPTS = [
    "Complete this sliding puzzle by moving the numbered tiles to their correct positions. "
    "Only one or two moves are needed. Show the tile(s) sliding into place.",
    
    "Finish solving this sliding puzzle. Move the tile(s) adjacent to the empty space "
    "to complete the puzzle. Demonstrate the final move(s).",
    
    "This sliding puzzle is almost complete. Make the final move(s) to arrange all "
    "numbered tiles in order. Show the tile(s) sliding into the correct position(s).",
]
```

## ğŸ“Š éš¾åº¦åˆ†çº§ç­–ç•¥

### æ ¸å¿ƒè®¾è®¡ç†å¿µï¼šæ¥è¿‘å®ŒæˆçŠ¶æ€
**å…³é”®æ€è·¯**ï¼šä»å®ŒæˆçŠ¶æ€å¼€å§‹ï¼Œåªæ‰§è¡Œ1-2æ­¥éšæœºç§»åŠ¨æ¥æ‰“ä¹±ã€‚è¿™æ ·ï¼š
- âœ… æ¨¡å‹åªéœ€è¦ç†è§£ç®€å•çš„ç§»åŠ¨è§„åˆ™
- âœ… æµ‹è¯•åŸºæœ¬çš„ç©ºé—´æ¨ç†å’Œç§»åŠ¨ç†è§£
- âœ… é¿å…å¤æ‚çš„å¤šæ­¥è§„åˆ’ï¼ˆè¶…å‡ºè§†é¢‘æ¨¡å‹èƒ½åŠ›ï¼‰
- âœ… æ›´å®¹æ˜“éªŒè¯æ¨¡å‹æ˜¯å¦æ­£ç¡®ç†è§£ä»»åŠ¡

### Easy (3Ã—3)
- **è§£é•¿åº¦**ï¼š1æ­¥
- **æ‰“ä¹±æ­¥æ•°**ï¼šä»å®ŒæˆçŠ¶æ€æ‰§è¡Œ1æ­¥éšæœºç§»åŠ¨
- **ç‰¹ç‚¹**ï¼šæœ€ç®€å•ï¼Œåªéœ€è¦ç§»åŠ¨ä¸€ä¸ªæ‹¼å›¾å—

### Medium (3Ã—3 æˆ– 4Ã—4)
- **è§£é•¿åº¦**ï¼š2æ­¥
- **æ‰“ä¹±æ­¥æ•°**ï¼šä»å®ŒæˆçŠ¶æ€æ‰§è¡Œ2æ­¥éšæœºç§»åŠ¨
- **ç‰¹ç‚¹**ï¼šéœ€è¦ä¸¤æ­¥ç§»åŠ¨ï¼Œæµ‹è¯•è¿ç»­ç§»åŠ¨çš„ç†è§£

### Hard (4Ã—4)
- **è§£é•¿åº¦**ï¼š2-3æ­¥
- **æ‰“ä¹±æ­¥æ•°**ï¼šä»å®ŒæˆçŠ¶æ€æ‰§è¡Œ2-3æ­¥éšæœºç§»åŠ¨
- **ç‰¹ç‚¹**ï¼šç¨å¾®å¤æ‚ï¼Œä½†ä»ä¿æŒç®€å•

## ğŸ¨ è§†è§‰è®¾è®¡

### æ‹¼å›¾å—æ ·å¼
- **æ•°å­—æ˜¾ç¤º**ï¼šå¤§å·å­—ä½“ï¼Œæ¸…æ™°å¯è§
- **èƒŒæ™¯è‰²**ï¼šæµ…è‰²èƒŒæ™¯ï¼ˆç™½è‰²/æµ…ç°ï¼‰
- **è¾¹æ¡†**ï¼šæ·±è‰²è¾¹æ¡†ï¼Œæ¸…æ™°åˆ†éš”
- **ç©ºç™½å—**ï¼šæ·±è‰²æˆ–ç‰¹æ®Šæ ‡è®°

### å›¾åƒè§„æ ¼
- **å°ºå¯¸**ï¼š400Ã—400 æˆ– 512Ã—512 åƒç´ 
- **æ ¼å¼**ï¼šPNGï¼ˆé«˜åˆ†è¾¨ç‡ï¼‰
- **èƒŒæ™¯**ï¼šç™½è‰²æˆ–æµ…ç°è‰²
- **ç½‘æ ¼çº¿**ï¼š2-3åƒç´ å®½ï¼Œæ·±è‰²

## âœ… éªŒæ”¶æ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**
   - âœ… èƒ½ç”Ÿæˆå¯è§£çš„æ‹¼å›¾
   - âœ… èƒ½æ­£ç¡®æ¸²æŸ“first_frameå’Œfinal_frame
   - âœ… èƒ½ç”Ÿæˆæœ‰æ•ˆçš„æç¤ºè¯

2. **è´¨é‡ä¿è¯**
   - âœ… æ‰€æœ‰æ‹¼å›¾éƒ½æ˜¯å¯è§£çš„
   - âœ… å›¾åƒæ¸…æ™°ï¼Œæ˜“äºè¯†åˆ«
   - âœ… éš¾åº¦åˆ†çº§åˆç†

3. **é›†æˆæµ‹è¯•**
   - âœ… èƒ½é€šè¿‡create_datasetç”Ÿæˆæ•°æ®é›†
   - âœ… èƒ½æ­£ç¡®æ³¨å†Œåˆ°DOMAIN_REGISTRY
   - âœ… èƒ½æ­£ç¡®ä¿å­˜åˆ°data/questions/

## ğŸš€ å¼€å§‹å®ç°

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–°åˆ†æ”¯
```bash
git checkout -b feature/add_sliding_puzzle
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç›®å½•ç»“æ„
```bash
mkdir -p vmevalkit/tasks/sliding_puzzle_task
```

### ç¬¬ä¸‰æ­¥ï¼šå®ç°æ ¸å¿ƒæ–‡ä»¶
æŒ‰ç…§Phase 1-4çš„é¡ºåºé€æ­¥å®ç°

## ğŸ“š å‚è€ƒèµ„æ–™

- [15-Puzzle Problem](https://en.wikipedia.org/wiki/15_puzzle)
- [A* Search Algorithm](https://en.wikipedia.org/wiki/A*_search_algorithm)
- [Manhattan Distance Heuristic](https://en.wikipedia.org/wiki/Taxicab_geometry)

